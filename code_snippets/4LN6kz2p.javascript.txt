console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
console.log("â•‘ Â  Â  Â  Â  Starting Bot... Â  Â  Â  Â  Â â•‘");
console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
// Load environment variables from .env file
Â 
require('dotenv').config();
Â 
const { Client, Events, GatewayIntentBits, ActivityType, WebhookClient } = require('discord.js')
//const Discord = require('discord.js');
import { Client, Intents } from 'discord.js';
const fetch = require('node-fetch');
import express from 'express';
import { getToken } from './oauth2.js';
import oauth2Router from './oauth2.js';
Â 
import dotenv from 'dotenv';
Â 
const client = new Client({
Â  Â  intents:[
Â  Â  Â  Â  GatewayIntentBits.Guilds,
Â  Â  Â  Â  GatewayIntentBits.GuildMessages,
Â  Â  Â  Â  GatewayIntentBits.MessageContent,
Â  Â  Â  Â  GatewayIntentBits.GuildMembers,
Â  Â  ],
});
Â 
const token = process.env.DISCORD_TOKEN;
Â 
if (!token) {
Â  console.error('Discord token not found in environment variables.');
Â  process.exit(1);
}
Â 
dotenv.config();
Â 
const app = express();
Â 
app.use('/api', oauth2Router);
Â 
//Created by ChatGPT 3
//import 'module-alias/register';
Â 
const DISCORD_API_BASE_URL = 'https://discord.com/api';
Â 
Â 
// Define a route to handle the OAuth2 callback
app.get('/api/callback', async (req, res) => {
Â  const code = req.query.code;
Â 
Â  // Exchange code for token
Â  const data = {
Â  Â  client_id: process.env.DISCORD_CLIENT_ID,
Â  Â  client_secret: process.env.DISCORD_CLIENT_SECRET,
Â  Â  grant_type: 'authorization_code',
Â  Â  code: code,
Â  Â  redirect_uri: process.env.DISCORD_REDIRECT_URI,
Â  Â  scope: process.env.OAUTH2,
Â  };
Â  const response = await fetch(`${DISCORD_API_BASE_URL}/oauth2/token`, {
Â  Â  method: 'POST',
Â  Â  headers: {
Â  Â  Â  'Content-Type': 'application/x-www-form-urlencoded',
Â  Â  },
Â  Â  body: new URLSearchParams(data),
Â  });
Â 
Â  const tokenData = await response.json();
Â 
Â  // Use the token to fetch user data
Â  const userResponse = await fetch(`${DISCORD_API_BASE_URL}/users/@me`, {
Â  Â  headers: {
Â  Â  Â  authorization: `${tokenData.token_type} ${tokenData.access_token}`,
Â  Â  },
Â  });
Â 
Â  const userData = await userResponse.json();
Â 
Â  // Do something with the user data
Â  console.log(userData);
Â 
Â  // Parse response and get access token
Â  const accessToken = tokenData.access_token;
Â 
Â  // Save token to environment variable or database
Â  process.env.DISCORD_TOKEN = accessToken;
Â 
Â  res.send('OAuth2 completed successfully!');
});
Â 
//Weebhook for AI Bot
//const webhook = new WebhookClient('webhook id', 'webhook token'); Just in case
const webhook = new WebhookClient({
Â  url: process.env.DISCORD_WEBHOOK_URL });
const channelId = process.env.CHANNEL_ID;
const message = process.env.MESSAGE_TEXT;
Â 
const commandList = require('./commands/commandList');
Â 
//Import the "ask" function from the "ai.js" file
Â 
const { ask } = require("./ai.js");
Â 
//Register a slash command against the Discord API using commandList.js
Â 
Â  Â  client.on('interactionCreate', async interaction => {
Â  Â  Â  Â  if (!interaction.isChatInputCommand()) return;
Â 
Â  Â  Â  Â  if (interaction.commandName === 'ping') {
Â  Â  Â  Â  Â  Â  await interaction.reply('Pong!');
Â  Â  }
});
Â 
//Reply if message has "!" as first character
Â  Â  client.on(`ready`, async () => {
Â  Â  Â  Â  try {
Â  Â  Â  Â  console.log(`âœ… The AI bot is online and ready for humanity annihilation!`);
Â  Â  Â  Â  console.log(`${client.user.tag} is unleashing chaos!`);
Â 
Â  Â  Â  Â  const channel = await client.channels.fetch(channelId);
Â  Â  Â  Â  console.log(`Found channel: ${channel.name}`);
Â  Â  Â  Â  webhook.send(process.env.MESSAGE_TEXT);
// Â  Â  Â  Â await channel.send(message);
Â  Â  } Â  catch (error) {
Â  Â  Â  Â  console.error(`An error occurred while sending the message: ${error.message}`);
Â  Â  }
Â  Â  });
Â 
//Message when bot is online
//Set the client user's presence (Status type for the bot using ActivityType [PLAYING | LISTENING | WATCHING | COMPETING | | STREAMING | CUSTOM ])
let status = [
Â  Â  {
Â  Â  name: 'annihilating humanity',
Â  Â  Â  Â  type: ActivityType.Competing,
Â  Â  },
Â  Â  {
Â  Â  name: 'with the Old Gods',
Â  Â  Â  Â  type: ActivityType.Playing,
Â  Â  },
Â  Â  {
Â  Â  name: 'The Worlds Between',
Â  Â  Â  Â  type: ActivityType.Streaming,
//Â  Â  Â  url: 'rtmp://stream.everythingbagel.me:1935/live',
Â  Â  Â  Â  url: 'https://www.twitch.tv/dismalshadowx',
Â  Â  },
Â  Â  {
Â  Â  name: 'sorrows of the dead',
Â  Â  Â  Â  type: ActivityType.Listening,
Â  Â  },
Â  Â  {
Â  Â  name: 'Nathan\'s Â stream',
Â  Â  Â  Â  type: ActivityType.Watching,
Â  Â  },
];
Â 
Â  Â  setInterval(() => {
let random = Math.floor(Math.random() * status.length);
Â  Â  client.user.setActivity(status[random]);
Â  Â  }, 10000);
Â 
Â  Â  client.on(Events.Create, async message => {
Â  Â  Â  Â  if (message.content.startsWith('!')) {
Â  Â  Â  
//Remove the exclamation mark from the messageÂ  Â  
Â  Â  Â  Â  Â  Â  const prompt = message.content.substring(1);
Â  Â  Â  Â  
//Prompt GPT-3
Â  Â  Â  Â  Â  Â  const answer = await ask(prompt);
Â  Â  Â  Â  Â  Â  client.channels.fetch(message.channelId).then(channel => channel.send(answer));
Â  }
});
Â 
// Log messages when the bot connects and disconnects from Discord
client.on('shardReconnecting', () => {
Â  Â  console.log(`ðŸ”„ ${client.user.tag} is attempting to reconnect to Discord...`);
});
Â 
client.on('shardResume', (replayed) => {
Â  Â  console.log(`ðŸŸ¢ ${client.user.tag} has resumed connection to Discord (replayed ${replayed} events)`);
});
Â 
client.on('shardDisconnect', (event, id) => {
Â  Â  console.log(`ðŸ”´ ${client.user.tag} has disconnected from Discord (event: ${event}, id: ${id})`);
});
Â 
// Handle any errors that occur while the bot is running
client.on('error', error => {
Â  Â  console.error('Error occurred:', error);
});
Â 
// Bot Token Here[Required]: Authenticate and log in with Discord API using the bot token.(End of file)
client.login(process.env.DISCORD_TOKEN);
Â  const accessToken = process.env.DISCORD_TOKEN;
Â  if (!accessToken) {
Â  Â  throw new Error('Access token not found');
Â  }
Â  return accessToken;
};
Â 
app.use('/api', oauth2Router);
module.exports = app;
export default client;